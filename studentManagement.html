<!DOCTYPE html>
<html>
<head>
    <title>Document</title>
</head>
<body>
Name:
<input type="text" id="name" placeholder="Enter Name"><br><br>
Email:
<input type="text" id="email" placeholder="Enter Email"><br><br>
Marks:
<input type="number" id="marks" placeholder="Enter Marks"><br><br>
<button onclick="addStudent()">Add Student</button>

<h3>Student List:</h3>
<ul id="studentList"></ul>

<script>

//  GLOBAL SCOPE 
let students = [];          
let emailSet = new Set();   
let gradeMap = new Map();   
function addStudent() {

    try {

        // Debugging
        debugger;

        // Local Scope
        const name = document.getElementById("name").value;
        const email = document.getElementById("email").value;
        const marks = Number(document.getElementById("marks").value);

        const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

        if (!emailPattern.test(email)) {
            throw new Error("Invalid Email Format!");
        }

        if (marks < 0 || marks > 100) {
            throw new Error("Marks must be between 0 and 100");
        }

        if (emailSet.has(email)) {
            throw new Error("Email already exists!");
        }

        emailSet.add(email);

        //  Object
        const student = {
            name,
            email,
            marks,
            date: new Date(),   
            getGrade: function() {
                return calculateGrade(this.marks);
            }
        };   
        students.push(student);
        gradeMap.set(email, student.getGrade());
        displayStudents();
        clearFields();
    } catch (error) {
        alert(error.message);
    }
}
function calculateGrade(marks) {
    if (marks >= 90) return "A";
    if (marks >= 75) return "B";
    if (marks >= 60) return "C";
    if (marks >= 40) return "D";
    return "Fail";
}
function displayStudents() {
    const list = document.getElementById("studentList");
    list.innerHTML = "";
    // Iteration
    students.forEach((student) => {
        // Destructuring
        const { name, email, marks, date } = student;
        const li = document.createElement("li");
        li.textContent = `
        Name: ${name},
        Email: ${email},
        Marks: ${marks},
        Grade: ${gradeMap.get(email)},
        Added On: ${date.toLocaleDateString()}
        `;
        list.appendChild(li);
    });
    calculateAverage();
}
function calculateAverage() {
    if (students.length === 0) return;
    let total = 0;
    for (let student of students) {   
        total += student.marks;
    }
    const average = Math.round(total / students.length);

    console.log("Class Average:", average);
}

//  CLEAR INPUT 
function clearFields() {
    document.getElementById("name").value = "";
    document.getElementById("email").value = "";
    document.getElementById("marks").value = "";
}

</script>

</body>
</html>